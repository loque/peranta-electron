!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("peranta/server"),require("peranta/router"));else if("function"==typeof define&&define.amd)define(["peranta/server","peranta/router"],e);else{var r="object"==typeof exports?e(require("peranta/server"),require("peranta/router")):e(t["peranta/server"],t["peranta/router"]);for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(this,function(t,e){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t,e){var r=this;if(void 0===t)throw new TypeError("Transport.constructor() expects to receive Electron's app as the first argument");if("function"!=typeof t.on)throw new TypeError("Transport.constructor() expects Electron's app to implement .on()");if(void 0===e)throw new TypeError("Transport.constructor() expects to receive Electron's ipcMain as the second argument");if("function"!=typeof e.on)throw new TypeError("Transport.constructor() expects Electron's ipcMain to implement .on()");this.app=t,this.ipcMain=e,this.broadcastScheduler=new c,this.webContents=[],this.app.on("web-contents-created",function(t,e){e.on("did-finish-load",function(){r.webContents.push(e),r.broadcastScheduler.start()})})}function o(t,e){return new i(new n(t,e),new s)}var i=r(2),s=r(3),c=r(4);n.prototype.on=function(t,e){this.ipcMain.on(t,function(t,r){return e(t,r)})},n.prototype.broadcast=function(t,e){var r=this;this.broadcastScheduler.push(function(){return r.webContents.forEach(function(r){r.send(t,e)}),Promise.resolve()})},t.exports={create:o}},,function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e){"use strict";function r(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=[],s=!1,c=!1;return this.addRetryAction=function(e,r,n){return r.__method=e,r.__retry=Object.assign({method:e},i,n),t.addAction(r)},this.addAction=function(e){var n={action:e},o=new Promise(function(t,e){n.__resolve=t,n.__reject=e});return r[e.__method](n),s&&!c&&t.next(),o},this.push=function(e){return e.__method=n,t.addAction(e)},this.unshift=function(e){return e.__method=o,t.addAction(e)},this.pushRetry=function(e,r){return t.addRetryAction(n,e,r)},this.unshiftRetry=function(e,r){return t.addRetryAction(o,e,r)},this.start=function(){s||(s=!0,t.next())},this.pause=function(){s=!1},this.next=function(){if(!s)return c=!1;var n=r.shift();if(!n)return c=!1;c=!0;var o=t.execute(n);e.sync?o.then(function(e){return t.next(),e}):setTimeout(t.next.bind(t),0)},this.execute=function(e){return e.action.__retry?(e.action.__retry.attempts++,e.action().then(e.__resolve).catch(function(r){return e.action.__retry.limit>0&&e.action.__retry.attempts==e.action.__retry.limit?void e.__reject("retry limit reached: "+e.action.__retry.limit):void t[e.action.__retry.method](e.action).then(e.__resolve).catch(e.__reject)})):e.action().then(e.__resolve).catch(e.__reject)},e.autostart&&this.start(),{push:this.push,unshift:this.unshift,pushRetry:this.pushRetry,unshiftRetry:this.unshiftRetry,start:this.start,pause:this.pause}}var n="push",o="unshift",i={limit:0,attempts:0};t.exports=r}])});